<!DOCTYPE html>

<html style="font-family:Arial; font-size:10px;">

	<head>
	
		<style>
			td { border:1px solid lightgrey; padding:3px; }
			thead { text-align:center; background-color:#EEEEEE; }
		</style>
		
	</head>
	
	<body>
	
		<script>

		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		var sections = {};
		
		var $d = [];
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		function addRecord ($direction, $type, $hour) {
		
			var $date = new Date();
			$date.setHours($hour);
		
			$d.push({
				"Created": new Date(),
				"DateTime": $date,
				"Direction": $direction,
				"Type": $type,
				"Volume": Number(prompt($hour + " " + $direction + " " + $type + " volume?")),
				"Comment": "comment.value",
				"Username": "gosn1fm"
			});
			
			build();
		
		};
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		function build () {
			
			table.querySelectorAll("tbody").forEach(function ($v) { $v.parentElement.removeChild($v); });
			table2.querySelectorAll("tbody").forEach(function ($v) { $v.parentElement.removeChild($v); });
			
			$calc = {};
			[
				"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "AM",
				"12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "PM"
			].forEach(function ($v) {
				$calc[$v] = {
					"Input": {"Oral":0, "IV Fluids":0, "NG Feed":0, "Other":0, "Total":0},
					"Output": {"Urine - Continent":0, "Urine - Incontinent":0, "Urine - Catheterised":0, "Gastric contents":0, "Drain":0, "Stoma":0, "Other":0, "Total":0},
					"Balance": 0
				};
			});
					
			$d.forEach(function ($x, $i) {
			
				var $h = new Date($x.DateTime).getHours();
				var $g = ($h <= 11) ? "AM" : "PM";
				var $dir = $x.Direction;
				var $t = $x.Type;
				var $v = $x.Volume;
				
				$calc[$h][$dir][$t] += $v;
				$calc[$h][$dir]["Total"] += $v;
				$calc[$g][$dir][$t] += $v;
				$calc[$g][$dir]["Total"] += $v;
				$calc[$g]["Balance"] += $v * ($dir === "Input" ? 1 : -1);
				$calc[$h]["Balance"] += $v * ($dir === "Input" ? 1 : -1);
				
				var tbody = document.createElement("tbody"); table2.appendChild(tbody);
				tbody.style.border = "3px solid grey";
				
				var tr = document.createElement("tr"); tbody.appendChild(tr);
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = new Date($x.DateTime).toDateString() + " " + new Date($x.DateTime).toTimeString().substr(0, 8);
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = $x.Direction;
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = $x.Type;
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = $x.Volume;
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = new Date($x.Created).toDateString() + " " + new Date($x.Created).toTimeString().substr(0, 8);
				var td = document.createElement("td"); tr.appendChild(td); td.textContent = $x.Username;
				
				var td = document.createElement("td"); tr.appendChild(td);
				td.textContent = "X";
				td.onpointerdown = function () {
					if (confirm("Sure?") == false) return; 
					$d.splice($i, 1);
					build();
				};
				
				if ($x.Comment !== "") {
					var tr = document.createElement("tr"); tbody.appendChild(tr);
					var td = document.createElement("td"); tr.appendChild(td);
					td.colSpan = 7;
					td.textContent = "Comment: " + $x.Comment;
				};
				
			});
			
			[
				"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "AM",
				"12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "PM"
			].forEach(function ($v) {
			
				var tbody = document.createElement("tbody"); table.appendChild(tbody);
				tbody.style.textAlign = "center";
				if (["AM", "PM"].indexOf($v) > -1) {
					tbody.style.fontWeight = "bold";
					tbody.style.backgroundColor = "yellow";
				} else {
					tbody.style.backgroundColor = (new Date().getHours() == $v) ? "lightgreen" : (new Date().getHours() < $v) ? "lightgrey" : "transparent";
				};
				var tr = document.createElement("tr"); tbody.appendChild(tr);
				
				var td = document.createElement("td"); tr.appendChild(td);
				td.style.borderLeft = "5px solid grey";
				td.style.borderRight = "5px solid grey";
				td.textContent = $v;

				// ----- ----- ----- ----- ----- ----- ----- ----- -----
				
				["Oral", "IV Fluids", "NG Feed", "Other"].forEach(function ($v2) {
					var td = document.createElement("td"); tr.appendChild(td);
					td.textContent = $calc[$v]["Input"][$v2] || "";
					if (["AM", "PM"].indexOf($v) === -1) td.onpointerdown = function () { addRecord("Input", $v2, $v); };
				});
				
				var td = document.createElement("td"); tr.appendChild(td);
				td.style.borderLeft = "5px solid grey";
				td.style.borderRight = "5px solid grey";
				td.textContent = $calc[$v]["Input"]['Total'] || "";
				
				// ----- ----- ----- ----- ----- ----- ----- ----- -----
				
				["Urine - Continent", "Urine - Incontinent", "Urine - Catheterised", "Gastric contents", "Drain", "Stoma", "Other"].forEach(function ($v2) {
					var td = document.createElement("td"); tr.appendChild(td);
					td.textContent = $calc[$v]["Output"][$v2] || "";
					if (["AM", "PM"].indexOf($v) === -1) td.onpointerdown = function () { addRecord("Output", $v2, $v); };
				});
				
				var td = document.createElement("td"); tr.appendChild(td);
				td.style.borderLeft = "5px solid grey";
				td.style.borderRight = "5px solid grey";
				td.textContent = $calc[$v]["Output"]["Total"] || "";
				
				var td = document.createElement("td"); tr.appendChild(td);
				td.style.borderLeft = "5px solid grey";
				td.style.borderRight = "5px solid grey";
				td.textContent = $calc[$v]["Balance"] || "";
				
			});
			
		};
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		var section = document.createElement("section"); sections["Table"] = section;
		
		var table = document.createElement("table"); section.appendChild(table);
		table.style.width = "100%";
		table.style.tableLayout = "fixed";
		table.style.borderCollapse = "collapse";
		
		var thead = document.createElement("thead"); table.appendChild(thead);
		[
			[["Time", 1, 3],
			["Input", 5, 1],
			["Output", 8, 1],
			["Balance", 1, 3]],
			[["Oral", 1, 2, function () { addRecord("Input", "Oral", new Date().getHours()); }],
			["IV Fluids", 1, 2, function () { addRecord("Input", "IV Fluids", new Date().getHours()); }],
			["NG Feed", 1, 2, function () { addRecord("Input", "NG Feed", new Date().getHours()); }],
			["Other", 1, 2, function () { addRecord("Input", "Other", new Date().getHours()); }],
			["Total", 1, 2],
			["Urine", 3, 1],
			["Gastric contents", 1, 2, function () { addRecord("Output", "Gastric contents", new Date().getHours()); }],
			["Drain", 1, 2, function () { addRecord("Output", "Drain", new Date().getHours()); }],
			["Stoma", 1, 2, function () { addRecord("Output", "Stoma", new Date().getHours()); }],
			["Other", 1, 2, function () { addRecord("Output", "Other", new Date().getHours()); }],
			["Total", 1, 2]],
			[["Continent", 1, 1, function () { addRecord("Output", "Urine - Continent", new Date().getHours()); }],
			["Incontinent", 1, 1, function () { addRecord("Output", "Urine - Incontinent", new Date().getHours()); }],
			["Catheterised", 1, 1, function () { addRecord("Output", "Urine - Catheterised", new Date().getHours()); }]]
		].forEach(function ($v) {
			var tr = document.createElement("tr"); thead.appendChild(tr);
			$v.forEach(function ($v2) {
				var td = document.createElement("td"); tr.appendChild(td);
				td.textContent = $v2[0];
				td.colSpan = $v2[1];
				td.rowSpan = $v2[2];
				td.onpointerdown = $v2[3];
			});
		});
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		var section = document.createElement("section"); sections["List"] = section;
		
		var table2 = document.createElement("table"); section.appendChild(table2);
		table2.style.width = "100%";
		table2.style.borderCollapse = "collapse";
		
		var thead = document.createElement("thead"); table2.appendChild(thead);
		var tr = document.createElement("tr"); thead.appendChild(tr);
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "DateTime";
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "Direction";
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "Type";
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "Volume";
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "Recorded";
		var td = document.createElement("td"); tr.appendChild(td); td.textContent = "Username";
		var td = document.createElement("td"); tr.appendChild(td);
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		
		var buttons = {};
		Object.keys(sections).forEach(function ($v) {
			var button = document.createElement("button"); document.body.appendChild(button);
			buttons[$v] = button;
			button.textContent = $v;
			button.onpointerdown = function () {
				main.textContent = "";
				main.appendChild(sections[$v]);
			};
		});
		
		var main = document.createElement("main"); document.body.appendChild(main);
		
		build();
		
		buttons["Table"].onpointerdown();
		
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
		// ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
	
		</script>
		
	</body>
	
</html>
